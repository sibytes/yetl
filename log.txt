INFO : 2022-12-18 12:26:18,377 : Audit : _audit.py.dataflow: line(102) : name: customer_details_landing_to_raw

INFO : 2022-12-18 12:26:18,377 : Audit : _audit.py.dataflow: line(102) : args:
  save: <class 'yetl.flow.save._saves.OverwriteSave'>
  timeslice: '*-*-* 00:00:00.000000'

INFO : 2022-12-18 12:26:18,377 : Audit : _audit.py.dataflow: line(102) : started: '2022-12-18 12:26:18'

INFO : 2022-12-18 12:26:18,378 : Audit : _audit.py.dataflow: line(102) : started_utc: '2022-12-18 12:26:18'

INFO : 2022-12-18 12:26:18,383 : Audit : _audit.py.dataflow: line(102) : context_id: f52ff3f5-ce47-4762-8930-840a85c7804b

22/12/18 12:26:20 WARN Utils: Your hostname, Shauns-MacBook-Pro.local resolves to a loopback address: 127.0.0.1; using 192.168.0.16 instead (on interface en0)
22/12/18 12:26:20 WARN Utils: Set SPARK_LOCAL_IP if you need to bind to another address
:: loading settings :: url = jar:file:/Users/shaunryan/opt/spark-3.3.1-bin-hadoop3/jars/ivy-2.5.0.jar!/org/apache/ivy/core/settings/ivysettings.xml
22/12/18 12:26:20 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
INFO : 2022-12-18 12:26:27,643 : Audit : _audit.py.dataset: line(98) : 764bece1-e108-4acb-b882-ec41a0cb56ee:
  database: demo_landing
  dataflow_id: e722d0b1-b0df-4c42-ab3d-3af6b337cb2b
  path: file:/Users/shaunryan/AzureDevOps/yetl/data/landing/demo/***/customer_details_***.csv
  table: customer_details
  type: Reader

INFO : 2022-12-18 12:26:42,481 : Audit : _audit.py.dataset_task: line(83) : CREATE TABLE IF NOT EXISTS `demo_landing`.`customer_details_exceptions` USING DELTA LOCATION 'file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/demo_landing/customer_details_exceptions';
INFO : 2022-12-18 12:26:42,481 : Audit : _audit.py.dataflow: line(102) : lineage:
  e722d0b1-b0df-4c42-ab3d-3af6b337cb2b: {}

INFO : 2022-12-18 12:26:42,483 : Audit : _audit.py.dataset: line(98) : 35265540-9758-4b87-ac12-952ec043998d:
  database: demo_raw
  dataflow_id: e722d0b1-b0df-4c42-ab3d-3af6b337cb2b
  path: file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/demo_raw/customer_details
  table: customer_details
  type: DeltaWriter

INFO : 2022-12-18 12:26:42,537 : Audit : _audit.py.dataset_task: line(83) : CREATE DATABASE IF NOT EXISTS demo_raw
INFO : 2022-12-18 12:26:45,280 : Audit : _audit.py.dataset_task: line(83) : CREATE TABLE demo_raw.customer_details ( `id` string , `first_name` string , `last_name` string , `email` string , `gender` string , `job_title` string , `amount` double , `_timeslice` timestamp , `_filepath_filename` string NOT NULL , `_partition_key` integer , `_dataset_id` string NOT NULL ) USING DELTA LOCATION 'file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/demo_raw/customer_details' PARTITIONED BY (`_partition_key`);
INFO : 2022-12-18 12:26:51,404 : Audit : _audit.py.dataset_task: line(83) : ['ALTER TABLE `demo_raw`.`customer_details` ADD CONSTRAINT amount_lower_bound CHECK (amount > -1000);', 'ALTER TABLE `demo_raw`.`customer_details` ADD CONSTRAINT amount_upper_bound CHECK (amount < 10000);']
You are setting a property: delta.autoOptimize.autoCompact that is not recognized by this version of Delta
You are setting a property: delta.autoOptimize.optimizeWrite that is not recognized by this version of Delta
INFO : 2022-12-18 12:26:53,457 : Audit : _audit.py.dataset_task: line(83) : ALTER TABLE `demo_raw`.`customer_details` SET TBLPROPERTIES ('delta.appendOnly' = 'False', 'delta.checkpoint.writeStatsAsJson' = 'True', 'delta.autoOptimize.autoCompact' = 'True', 'delta.autoOptimize.optimizeWrite' = 'True', 'delta.compatibility.symlinkFormatManifest.enabled' = 'False', 'delta.dataSkippingNumIndexedCols' = '-1', 'delta.logRetentionDuration' = 'interval 30 days', 'delta.deletedFileRetentionDuration' = 'interval 1 week', 'delta.enableChangeDataFeed' = 'True', 'delta.minReaderVersion' = '1', 'delta.minWriterVersion' = '2', 'delta.randomizeFilePrefixes' = 'False', 'delta.randomPrefixLength' = '2');
INFO : 2022-12-18 12:26:53,458 : Audit : _audit.py.dataflow: line(102) : lineage:
  e722d0b1-b0df-4c42-ab3d-3af6b337cb2b:
    35265540-9758-4b87-ac12-952ec043998d:
      depends_on:
      - 764bece1-e108-4acb-b882-ec41a0cb56ee

INFO : 2022-12-18 12:26:53,591 : Audit : _audit.py.dataset_task: line(83) : {'path': 'file:/Users/shaunryan/AzureDevOps/yetl/data/landing/demo/***/customer_details_***.csv', 'options': {'mode': 'PERMISSIVE', 'inferSchema': False, 'header': True}}
WARNING : 2022-12-18 12:26:54,211 : Reader : _reader.py.handle_exceptions: line(296) : Writing 1 exception(s) from demo_landing.customer_details to demo_landing.customer_details_exceptions delta table _context_id=f52ff3f5-ce47-4762-8930-840a85c7804b
WARNING : 2022-12-18 12:26:57,916 : PermissiveSchemaOnRead : _validation.py.raise_thresholds: line(97) : warning Thresholds:
	exception_percent threshold exceeded: 3.225806451612903 > 0
WARNING : 2022-12-18 12:26:57,917 : PermissiveSchemaOnRead : _validation.py.get_result: line(125) : {
    "validation": {
        "thresholds": {
            "warning": {
                "min_rows": 1,
                "max_rows": 1000,
                "exception_count": 0,
                "exception_percent": 0
            },
            "error": {
                "min_rows": 0,
                "max_rows": 100000000,
                "exception_count": 50,
                "exception_percent": 80
            }
        },
        "schema_on_read": {
            "demo_landing.customer_details": {
                "total_count": 31,
                "valid_count": 30,
                "exception_count": 1,
                "exception_percent": 3.225806451612903
            }
        }
    }
}
INFO : 2022-12-18 12:26:57,917 : Audit : _audit.py.dataset_task: line(83) : {'validation': {'thresholds': {'warning': {'min_rows': 1, 'max_rows': 1000, 'exception_count': 0, 'exception_percent': 0}, 'error': {'min_rows': 0, 'max_rows': 100000000, 'exception_count': 50, 'exception_percent': 80}}, 'schema_on_read': {'demo_landing.customer_details': {'total_count': 31, 'valid_count': 30, 'exception_count': 1, 'exception_percent': 3.225806451612903}}}}
+---+----------+---------------+--------------------+----------+--------------------+------+-------------------+--------------------+--------------------+--------------+
| id|first_name|      last_name|               email|    gender|           job_title|amount|         _timeslice|  _filepath_filename|         _dataset_id|_partition_key|
+---+----------+---------------+--------------------+----------+--------------------+------+-------------------+--------------------+--------------------+--------------+
|  1|   Davidde|         Legier|    dlegier0@mail.ru|   Agender|              Editor|  86.5|2021-01-01 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20210101|
|  2|  Panchito|        Scirman|pscirman1@kicksta...|      Male|    Junior Executive| 36.18|2021-01-01 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20210101|
|  3|      Chic|       Ickowics|cickowics2@bookin...|      Male|  Research Associate| 35.54|2021-01-01 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20210101|
|  4|   Pascale|Jedrzaszkiewicz|pjedrzaszkiewicz3...|      Male|Safety Technician IV| 73.21|2021-01-01 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20210101|
|  5|      Sara|       Whiterod|  swhiterod4@hhs.gov|    Female|   Assistant Manager| 47.85|2021-01-01 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20210101|
|  6|   Mariska|         Antrum|mantrum5@nytimes.com|    Female|      Tax Accountant| 16.37|2021-01-01 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20210101|
|  7|   Ingemar|         Petrus|ipetrus6@blogspot...|      Male|Chief Design Engi...| 49.02|2021-01-01 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20210101|
|  8|   Anstice|    Hollingdale|ahollingdale7@yah...|    Female|     Cost Accountant| 21.94|2021-01-01 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20210101|
|  9|   Chaunce|      Holdforth|  choldforth8@ca.gov|Non-binary|Chief Design Engi...|  72.0|2021-01-01 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20210101|
| 10|    Blinni|          Fenty|bfenty9@paginegia...|    Female|Assistant Media P...| 38.98|2021-01-01 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20210101|
| 11|   Davidde|         Legier|    dlegier0@mail.ru|   Agender|              Editor|  86.5|2022-07-12 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20220712|
| 12|  Panchito|        Scirman|pscirman1@kicksta...|      Male|    Junior Executive| 36.18|2022-07-12 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20220712|
| 13|      Chic|       Ickowics|cickowics2@bookin...|      Male|  Research Associate| 35.54|2022-07-12 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20220712|
| 14|   Pascale|Jedrzaszkiewicz|pjedrzaszkiewicz3...|      Male|Safety Technician IV| 73.21|2022-07-12 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20220712|
| 15|      Sara|       Whiterod|  swhiterod4@hhs.gov|    Female|   Assistant Manager| 47.85|2022-07-12 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20220712|
| 16|   Mariska|         Antrum|mantrum5@nytimes.com|    Female|      Tax Accountant| 16.37|2022-07-12 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20220712|
| 17|   Ingemar|         Petrus|ipetrus6@blogspot...|      Male|Chief Design Engi...| 49.02|2022-07-12 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20220712|
| 18|   Anstice|    Hollingdale|ahollingdale7@yah...|    Female|     Cost Accountant| 21.94|2022-07-12 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20220712|
| 19|   Chaunce|      Holdforth|  choldforth8@ca.gov|Non-binary|Chief Design Engi...|  72.0|2022-07-12 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20220712|
| 20|    Blinni|          Fenty|bfenty9@paginegia...|    Female|Assistant Media P...| 38.98|2022-07-12 00:00:00|file:///Users/sha...|764bece1-e108-4ac...|      20220712|
+---+----------+---------------+--------------------+----------+--------------------+------+-------------------+--------------------+--------------------+--------------+
only showing top 20 rows

INFO : 2022-12-18 12:27:01,542 : Audit : _audit.py.dataset_task: line(83) : {'version': 4, 'timestamp': datetime.datetime(2022, 12, 18, 12, 26, 58, 931000), 'userId': None, 'userName': None, 'operation': 'WRITE', 'operationParameters': {'mode': 'Overwrite', 'partitionBy': '["_partition_key"]'}, 'job': None, 'notebook': None, 'clusterId': None, 'readVersion': 3, 'isolationLevel': 'Serializable', 'isBlindAppend': False, 'operationMetrics': {'numOutputRows': '30', 'numOutputBytes': '13743', 'numFiles': '3'}, 'userMetadata': None, 'engineInfo': 'Apache-Spark/3.3.1 Delta-Lake/2.1.1'}
INFO : 2022-12-18 12:27:01,542 : Audit : _audit.py.dataflow: line(102) : finished: '2022-12-18 12:27:01'

INFO : 2022-12-18 12:27:01,542 : Audit : _audit.py.dataflow: line(102) : finished_utc: '2022-12-18 12:27:01'

{
    "dataflow": {
        "datasets": {
            "764bece1-e108-4acb-b882-ec41a0cb56ee": {
                "type": "Reader",
                "dataflow_id": "e722d0b1-b0df-4c42-ab3d-3af6b337cb2b",
                "database": "demo_landing",
                "table": "customer_details",
                "path": "file:/Users/shaunryan/AzureDevOps/yetl/data/landing/demo/***/customer_details_***.csv",
                "tasks": {
                    "0": {
                        "task": "sql",
                        "message": "CREATE TABLE IF NOT EXISTS `demo_landing`.`customer_details_exceptions` USING DELTA LOCATION 'file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/demo_landing/customer_details_exceptions';",
                        "start_datetime": "2022-12-18 12:26:33",
                        "end_datetime": "2022-12-18 12:26:42",
                        "seconds_duration": 8.950977
                    },
                    "1": {
                        "task": "lazy_read",
                        "message": {
                            "path": "file:/Users/shaunryan/AzureDevOps/yetl/data/landing/demo/***/customer_details_***.csv",
                            "options": {
                                "mode": "PERMISSIVE",
                                "inferSchema": false,
                                "header": true
                            }
                        },
                        "start_datetime": "2022-12-18 12:26:53",
                        "end_datetime": "2022-12-18 12:26:53",
                        "seconds_duration": 0.133196
                    },
                    "2": {
                        "task": "schema_on_read_validation",
                        "message": {
                            "validation": {
                                "thresholds": {
                                    "warning": {
                                        "min_rows": 1,
                                        "max_rows": 1000,
                                        "exception_count": 0,
                                        "exception_percent": 0
                                    },
                                    "error": {
                                        "min_rows": 0,
                                        "max_rows": 100000000,
                                        "exception_count": 50,
                                        "exception_percent": 80
                                    }
                                },
                                "schema_on_read": {
                                    "demo_landing.customer_details": {
                                        "total_count": 31,
                                        "valid_count": 30,
                                        "exception_count": 1,
                                        "exception_percent": 3.225806451612903
                                    }
                                }
                            }
                        },
                        "start_datetime": "2022-12-18 12:26:53",
                        "end_datetime": "2022-12-18 12:26:57",
                        "seconds_duration": 4.32591
                    }
                }
            },
            "35265540-9758-4b87-ac12-952ec043998d": {
                "type": "DeltaWriter",
                "dataflow_id": "e722d0b1-b0df-4c42-ab3d-3af6b337cb2b",
                "database": "demo_raw",
                "table": "customer_details",
                "path": "file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/demo_raw/customer_details",
                "tasks": {
                    "0": {
                        "task": "sql",
                        "message": "CREATE DATABASE IF NOT EXISTS demo_raw",
                        "start_datetime": "2022-12-18 12:26:42",
                        "end_datetime": "2022-12-18 12:26:42",
                        "seconds_duration": 0.052309
                    },
                    "1": {
                        "task": "sql",
                        "message": "CREATE TABLE demo_raw.customer_details ( `id` string , `first_name` string , `last_name` string , `email` string , `gender` string , `job_title` string , `amount` double , `_timeslice` timestamp , `_filepath_filename` string NOT NULL , `_partition_key` integer , `_dataset_id` string NOT NULL ) USING DELTA LOCATION 'file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/demo_raw/customer_details' PARTITIONED BY (`_partition_key`);",
                        "start_datetime": "2022-12-18 12:26:42",
                        "end_datetime": "2022-12-18 12:26:45",
                        "seconds_duration": 2.670533
                    },
                    "2": {
                        "task": "set_table_properties",
                        "message": [
                            "ALTER TABLE `demo_raw`.`customer_details` ADD CONSTRAINT amount_lower_bound CHECK (amount > -1000);",
                            "ALTER TABLE `demo_raw`.`customer_details` ADD CONSTRAINT amount_upper_bound CHECK (amount < 10000);"
                        ],
                        "start_datetime": "2022-12-18 12:26:45",
                        "end_datetime": "2022-12-18 12:26:51",
                        "seconds_duration": 6.123843
                    },
                    "3": {
                        "task": "set_table_properties",
                        "message": "ALTER TABLE `demo_raw`.`customer_details` SET TBLPROPERTIES ('delta.appendOnly' = 'False', 'delta.checkpoint.writeStatsAsJson' = 'True', 'delta.autoOptimize.autoCompact' = 'True', 'delta.autoOptimize.optimizeWrite' = 'True', 'delta.compatibility.symlinkFormatManifest.enabled' = 'False', 'delta.dataSkippingNumIndexedCols' = '-1', 'delta.logRetentionDuration' = 'interval 30 days', 'delta.deletedFileRetentionDuration' = 'interval 1 week', 'delta.enableChangeDataFeed' = 'True', 'delta.minReaderVersion' = '1', 'delta.minWriterVersion' = '2', 'delta.randomizeFilePrefixes' = 'False', 'delta.randomPrefixLength' = '2');",
                        "start_datetime": "2022-12-18 12:26:51",
                        "end_datetime": "2022-12-18 12:26:53",
                        "seconds_duration": 2.052659
                    },
                    "4": {
                        "task": "delta_table_write",
                        "message": {
                            "version": 4,
                            "timestamp": "2022-12-18 12:26:58.931000",
                            "userId": null,
                            "userName": null,
                            "operation": "WRITE",
                            "operationParameters": {
                                "mode": "Overwrite",
                                "partitionBy": "[\"_partition_key\"]"
                            },
                            "job": null,
                            "notebook": null,
                            "clusterId": null,
                            "readVersion": 3,
                            "isolationLevel": "Serializable",
                            "isBlindAppend": false,
                            "operationMetrics": {
                                "numOutputRows": "30",
                                "numOutputBytes": "13743",
                                "numFiles": "3"
                            },
                            "userMetadata": null,
                            "engineInfo": "Apache-Spark/3.3.1 Delta-Lake/2.1.1"
                        },
                        "start_datetime": "2022-12-18 12:26:58",
                        "end_datetime": "2022-12-18 12:27:01",
                        "seconds_duration": 3.521278
                    }
                }
            }
        },
        "name": "customer_details_landing_to_raw",
        "args": {
            "timeslice": "*-*-* 00:00:00.000000",
            "save": "<class 'yetl.flow.save._saves.OverwriteSave'>"
        },
        "started": "2022-12-18 12:26:18",
        "started_utc": "2022-12-18 12:26:18",
        "context_id": "f52ff3f5-ce47-4762-8930-840a85c7804b",
        "lineage": {
            "e722d0b1-b0df-4c42-ab3d-3af6b337cb2b": {
                "35265540-9758-4b87-ac12-952ec043998d": {
                    "depends_on": [
                        "764bece1-e108-4acb-b882-ec41a0cb56ee"
                    ]
                }
            }
        },
        "finished": "2022-12-18 12:27:01",
        "finished_utc": "2022-12-18 12:27:01"
    },
    "warning": {
        "count": 0
    },
    "error": {
        "count": 0
    }
}
