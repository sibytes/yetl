INFO : 2022-08-07 20:12:51,071 : cdc_customer_landing_to_rawdb_csv : _config_provider.py.load_config: line(41) : Loading Dataflow configuration from file /Users/shaunryan/AzureDevOps/yetl/config/pipeline/local/config.yaml
INFO : 2022-08-07 20:12:51,073 : cdc_customer_landing_to_rawdb_csv : _context.py._get_spark_context: line(85) : Setting spark context
:: loading settings :: url = jar:file:/Users/shaunryan/opt/spark-3.2.1-bin-hadoop3.2/jars/ivy-2.5.0.jar!/org/apache/ivy/core/settings/ivysettings.xml
INFO : 2022-08-07 20:12:55,379 : cdc_customer_landing_to_rawdb_csv : _context.py.__init__: line(50) : Setting application context spark logger at level ERROR
INFO : 2022-08-07 20:12:55,382 : cdc_customer_landing_to_rawdb_csv : _factory.py.get_file_system_type: line(50) : Setting filestystem using protocol file:
INFO : 2022-08-07 20:12:55,382 : cdc_customer_landing_to_rawdb_csv : _context.py.__init__: line(66) : Setting application context dataflow cdc_customer_landing_to_rawdb_csv
INFO : 2022-08-07 20:12:55,383 : cdc_customer_landing_to_rawdb_csv : _config_provider.py.load_pipeline_config: line(29) : Loading Dataflow configuration from file /Users/shaunryan/AzureDevOps/yetl/config/pipeline/local/cdc_customer_landing_to_rawdb_csv.yaml
INFO : 2022-08-07 20:12:55,395 : cdc_customer_landing_to_rawdb_csv : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on spark_schema_file 
INFO : 2022-08-07 20:12:55,395 : cdc_customer_landing_to_rawdb_csv : _spark_file_schema_repo.py.load_schema: line(50) : Loading schema for dataset landing.cdc_customer from /Users/shaunryan/AzureDevOps/yetl/config/schema/spark/landing/cdc_customer.yaml using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-07 20:12:55,400 : cdc_customer_landing_to_rawdb_csv : _reader.py.__init__: line(49) : auto_io = True automatically creating or altering exception delta table landing.cdc_customer _correlation_id=86b02a72-2e35-413a-b807-5eaca2252b39
INFO : 2022-08-07 20:12:55,400 : cdc_customer_landing_to_rawdb_csv : _delta_lake.py.create_database: line(27) : Creating database if not exists `landing`
INFO : 2022-08-07 20:13:03,143 : cdc_customer_landing_to_rawdb_csv : _delta_lake.py.create_table: line(16) : Creating table if not exists landing.exceptions at file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/exceptions/landing/exceptions
INFO : 2022-08-07 20:13:10,257 : cdc_customer_landing_to_rawdb_csv : _reader.py.read: line(195) : Reading data for landing.cdc_customer from file:/Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv with options {'mode': 'PERMISSIVE', 'inferSchema': False, 'header': True, 'timestampFormat': 'yyyy-MM-dd HH:mm:ss'} _correlation_id=86b02a72-2e35-413a-b807-5eaca2252b39
INFO : 2022-08-07 20:13:10,361 : cdc_customer_landing_to_rawdb_csv : _reader.py.validate: line(181) : Validating dataframe read using PERMISSIVE corrupt column at _corrupt_record _correlation_id=86b02a72-2e35-413a-b807-5eaca2252b39
INFO : 2022-08-07 20:13:10,910 : cdc_customer_landing_to_rawdb_csv : _reader.py.validate: line(192) : {
    "validation": {
        "schema_on_read": {
            "landing.cdc_customer": {
                "total_count": 10,
                "valid_count": 10,
                "exception_count": 0
            }
        }
    }
}
INFO : 2022-08-07 20:13:10,911 : cdc_customer_landing_to_rawdb_csv : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on deltalake_sql_file 
INFO : 2022-08-07 20:13:10,911 : cdc_customer_landing_to_rawdb_csv : _deltalake_sql_file.py.load_schema: line(43) : Loading schema for dataset raw.cdc_customer from ./config/schema/deltalake/raw/cdc_customer.sql using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-07 20:13:10,911 : cdc_customer_landing_to_rawdb_csv : _writer.py.__init__: line(40) : auto_io = True automatically creating or altering delta table raw.cdc_customer
INFO : 2022-08-07 20:13:10,911 : cdc_customer_landing_to_rawdb_csv : _delta_lake.py.create_database: line(27) : Creating database if not exists `raw`
INFO : 2022-08-07 20:13:11,004 : cdc_customer_landing_to_rawdb_csv : _delta_lake.py.create_table: line(16) : Creating table if not exists raw.cdc_customer at file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/raw/cdc_customer
INFO : 2022-08-07 20:13:20,477 : cdc_customer_landing_to_rawdb_csv : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on deltalake_sql_file 
INFO : 2022-08-07 20:13:20,477 : cdc_customer_landing_to_rawdb_csv : _deltalake_sql_file.py.load_schema: line(43) : Loading schema for dataset raw.cdc_customer_history from ./config/schema/deltalake/raw/cdc_customer_history.sql using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-07 20:13:20,478 : cdc_customer_landing_to_rawdb_csv : _writer.py.__init__: line(40) : auto_io = True automatically creating or altering delta table raw.cdc_customer_history
INFO : 2022-08-07 20:13:20,478 : cdc_customer_landing_to_rawdb_csv : _delta_lake.py.create_database: line(27) : Creating database if not exists `raw`
INFO : 2022-08-07 20:13:20,551 : cdc_customer_landing_to_rawdb_csv : _delta_lake.py.create_table: line(16) : Creating table if not exists raw.cdc_customer_history at file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/raw/cdc_customer_history
INFO : 2022-08-07 20:13:28,054 : cdc_customer_landing_to_rawdb_csv : _framework.py.wrap_function: line(36) : Executing Dataflow cdc_customer_landing_to_rawdb_csv with:
                timeslice=2022-08-01 00:00:00.000000 
                retries=2 
                save_type=DefaultSave
INFO : 2022-08-07 20:13:28,145 : cdc_customer_landing_to_rawdb_csv : cdc_main.py.cdc_customer_landing_to_rawdb_csv: line(34) : Fetched dst delta table raw.cdc_customer from file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/raw/cdc_customer
INFO : 2022-08-07 20:13:28,152 : cdc_customer_landing_to_rawdb_csv : cdc_main.py.cdc_customer_landing_to_rawdb_csv: line(41) : Fetched dst delta table raw.cdc_customer_history from file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/raw/cdc_customer_history
INFO : 2022-08-07 20:13:28,425 : cdc_customer_landing_to_rawdb_csv : cdc_main.py.cdc_customer_landing_to_rawdb_csv: line(92) : Change set
+---+-------------------+---------+----------+---------------+--------------------+----------+--------------------+------+----------+----------+-------+------+--------------------+--------------------+--------------------+
| id|       extract_date|load_flag|first_name|      last_name|               email|    gender|           job_title|amount| from_date|   to_date|version|active|     _correlation_id|     _load_timestamp|           _filename|
+---+-------------------+---------+----------+---------------+--------------------+----------+--------------------+------+----------+----------+-------+------+--------------------+--------------------+--------------------+
|  1|2008-01-01 00:00:00|        I|   Davidde|         Legier|    dlegier0@mail.ru|   Agender|              Editor|  86.5|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|        Scirman|pscirman1@kicksta...|      Male|    Junior Executive| 36.18|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  3|2008-01-01 00:00:00|        I|      Chic|       Ickowics|cickowics2@bookin...|      Male|  Research Associate| 35.54|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  4|2008-01-01 00:00:00|        I|   Pascale|Jedrzaszkiewicz|pjedrzaszkiewicz3...|      Male|Safety Technician IV| 73.21|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  5|2008-01-01 00:00:00|        I|      Sara|       Whiterod|  swhiterod4@hhs.gov|    Female|   Assistant Manager| 47.85|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  6|2008-01-01 00:00:00|        I|   Mariska|         Antrum|mantrum5@nytimes.com|    Female|      Tax Accountant| 16.37|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  7|2008-01-01 00:00:00|        I|   Ingemar|         Petrus|ipetrus6@blogspot...|      Male|Chief Design Engi...| 49.02|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  8|2008-01-01 00:00:00|        I|   Anstice|    Hollingdale|ahollingdale7@yah...|    Female|     Cost Accountant| 21.94|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  9|2008-01-01 00:00:00|        I|   Chaunce|      Holdforth|  choldforth8@ca.gov|Non-binary|Chief Design Engi...|  72.0|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
| 10|2008-01-01 00:00:00|        I|    Blinni|          Fenty|bfenty9@paginegia...|    Female|Assistant Media P...| 38.98|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
+---+-------------------+---------+----------+---------------+--------------------+----------+--------------------+------+----------+----------+-------+------+--------------------+--------------------+--------------------+

INFO : 2022-08-07 20:13:37,577 : cdc_customer_landing_to_rawdb_csv : cdc_main.py.cdc_customer_landing_to_rawdb_csv: line(111) : Current
+-------------------+---------+---+----------+---------------+--------------------+----------+--------------------+------+----------+----------+-------+------+--------------------+--------------------+--------------------+
|       extract_date|load_flag| id|first_name|      last_name|               email|    gender|           job_title|amount| from_date|   to_date|version|active|     _correlation_id|     _load_timestamp|           _filename|
+-------------------+---------+---+----------+---------------+--------------------+----------+--------------------+------+----------+----------+-------+------+--------------------+--------------------+--------------------+
|2008-01-01 00:00:00|        I|  1|   Davidde|         Legier|    dlegier0@mail.ru|   Agender|              Editor|  86.5|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|2008-01-01 00:00:00|        I|  2|  Panchito|        Scirman|pscirman1@kicksta...|      Male|    Junior Executive| 36.18|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|2008-01-01 00:00:00|        I|  3|      Chic|       Ickowics|cickowics2@bookin...|      Male|  Research Associate| 35.54|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|2008-01-01 00:00:00|        I|  4|   Pascale|Jedrzaszkiewicz|pjedrzaszkiewicz3...|      Male|Safety Technician IV| 73.21|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|2008-01-01 00:00:00|        I|  5|      Sara|       Whiterod|  swhiterod4@hhs.gov|    Female|   Assistant Manager| 47.85|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|2008-01-01 00:00:00|        I|  6|   Mariska|         Antrum|mantrum5@nytimes.com|    Female|      Tax Accountant| 16.37|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|2008-01-01 00:00:00|        I|  7|   Ingemar|         Petrus|ipetrus6@blogspot...|      Male|Chief Design Engi...| 49.02|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|2008-01-01 00:00:00|        I|  8|   Anstice|    Hollingdale|ahollingdale7@yah...|    Female|     Cost Accountant| 21.94|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|2008-01-01 00:00:00|        I|  9|   Chaunce|      Holdforth|  choldforth8@ca.gov|Non-binary|Chief Design Engi...|  72.0|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|2008-01-01 00:00:00|        I| 10|    Blinni|          Fenty|bfenty9@paginegia...|    Female|Assistant Media P...| 38.98|2008-01-01|9999-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
+-------------------+---------+---+----------+---------------+--------------------+----------+--------------------+------+----------+----------+-------+------+--------------------+--------------------+--------------------+

ERROR : 2022-08-07 20:13:38,008 : cdc_customer_landing_to_rawdb_csv : _framework.py.wrap_function: line(56) : Dataflow application cdc_customer_landing_to_rawdb_csv failed due to 'DeltaMergeBuilder' object has no attribute 'whenMatchedUpdat'.
INFO : 2022-08-07 20:13:38,008 : cdc_customer_landing_to_rawdb_csv : _framework.py.wrap_function: line(59) : Retrying cdc_customer_landing_to_rawdb_csv in after 1 seconds; 1 retries are remaning.
INFO : 2022-08-07 20:13:39,044 : cdc_customer_landing_to_rawdb_csv : cdc_main.py.cdc_customer_landing_to_rawdb_csv: line(34) : Fetched dst delta table raw.cdc_customer from file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/raw/cdc_customer
INFO : 2022-08-07 20:13:39,053 : cdc_customer_landing_to_rawdb_csv : cdc_main.py.cdc_customer_landing_to_rawdb_csv: line(41) : Fetched dst delta table raw.cdc_customer_history from file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/raw/cdc_customer_history
INFO : 2022-08-07 20:13:39,225 : cdc_customer_landing_to_rawdb_csv : cdc_main.py.cdc_customer_landing_to_rawdb_csv: line(92) : Change set
+---+-------------------+---------+----------+---------+--------------------+-------+----------------+------+----------+----------+-------+------+--------------------+--------------------+--------------------+
| id|       extract_date|load_flag|first_name|last_name|               email| gender|       job_title|amount| from_date|   to_date|version|active|     _correlation_id|     _load_timestamp|           _filename|
+---+-------------------+---------+----------+---------+--------------------+-------+----------------+------+----------+----------+-------+------+--------------------+--------------------+--------------------+
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|9999-12-31|      2| false|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
+---+-------------------+---------+----------+---------+--------------------+-------+----------------+------+----------+----------+-------+------+--------------------+--------------------+--------------------+
only showing top 20 rows

ERROR : 2022-08-07 20:13:42,534 : cdc_customer_landing_to_rawdb_csv : _framework.py.wrap_function: line(56) : Dataflow application cdc_customer_landing_to_rawdb_csv failed due to An error occurred while calling o314.execute.
: org.apache.spark.sql.delta.DeltaUnsupportedOperationException: Cannot perform Merge as multiple source rows matched and attempted to modify the same
target row in the Delta table in possibly conflicting ways. By SQL semantics of Merge,
when multiple source rows match on the same target row, the result may be ambiguous
as it is unclear which source row should be used to update or delete the matching
target row. You can preprocess the source table to eliminate the possibility of
multiple matches. Please refer to
https://docs.delta.io/latest/delta-update.html#upsert-into-a-table-using-merge
	at org.apache.spark.sql.delta.DeltaErrorsBase.multipleSourceRowMatchingTargetRowInMergeException(DeltaErrors.scala:1028)
	at org.apache.spark.sql.delta.DeltaErrorsBase.multipleSourceRowMatchingTargetRowInMergeException$(DeltaErrors.scala:1025)
	at org.apache.spark.sql.delta.DeltaErrors$.multipleSourceRowMatchingTargetRowInMergeException(DeltaErrors.scala:2264)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.$anonfun$findTouchedFiles$1(MergeIntoCommand.scala:434)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.recordMergeOperation(MergeIntoCommand.scala:855)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.findTouchedFiles(MergeIntoCommand.scala:370)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.$anonfun$run$2(MergeIntoCommand.scala:317)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.$anonfun$run$2$adapted(MergeIntoCommand.scala:300)
	at org.apache.spark.sql.delta.DeltaLog.withNewTransaction(DeltaLog.scala:224)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.$anonfun$run$1(MergeIntoCommand.scala:300)
	at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.java:23)
	at org.apache.spark.sql.delta.metering.DeltaLogging.recordFrameProfile(DeltaLogging.scala:141)
	at org.apache.spark.sql.delta.metering.DeltaLogging.recordFrameProfile$(DeltaLogging.scala:139)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.recordFrameProfile(MergeIntoCommand.scala:206)
	at org.apache.spark.sql.delta.metering.DeltaLogging.$anonfun$recordDeltaOperationInternal$1(DeltaLogging.scala:134)
	at com.databricks.spark.util.DatabricksLogging.recordOperation(DatabricksLogging.scala:77)
	at com.databricks.spark.util.DatabricksLogging.recordOperation$(DatabricksLogging.scala:67)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.recordOperation(MergeIntoCommand.scala:206)
	at org.apache.spark.sql.delta.metering.DeltaLogging.recordDeltaOperationInternal(DeltaLogging.scala:133)
	at org.apache.spark.sql.delta.metering.DeltaLogging.recordDeltaOperation(DeltaLogging.scala:123)
	at org.apache.spark.sql.delta.metering.DeltaLogging.recordDeltaOperation$(DeltaLogging.scala:111)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.recordDeltaOperation(MergeIntoCommand.scala:206)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.run(MergeIntoCommand.scala:298)
	at io.delta.tables.DeltaMergeBuilder.$anonfun$execute$1(DeltaMergeBuilder.scala:231)
	at org.apache.spark.sql.delta.util.AnalysisHelper.improveUnsupportedOpError(AnalysisHelper.scala:105)
	at org.apache.spark.sql.delta.util.AnalysisHelper.improveUnsupportedOpError$(AnalysisHelper.scala:91)
	at io.delta.tables.DeltaMergeBuilder.improveUnsupportedOpError(DeltaMergeBuilder.scala:123)
	at io.delta.tables.DeltaMergeBuilder.execute(DeltaMergeBuilder.scala:207)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)
	at py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)
	at py4j.Gateway.invoke(Gateway.java:282)
	at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)
	at py4j.commands.CallCommand.execute(CallCommand.java:79)
	at py4j.ClientServerConnection.waitForCommands(ClientServerConnection.java:182)
	at py4j.ClientServerConnection.run(ClientServerConnection.java:106)
	at java.base/java.lang.Thread.run(Thread.java:834)
.
INFO : 2022-08-07 20:13:42,535 : cdc_customer_landing_to_rawdb_csv : _framework.py.wrap_function: line(59) : Retrying cdc_customer_landing_to_rawdb_csv in after 1 seconds; 0 retries are remaning.
INFO : 2022-08-07 20:13:43,567 : cdc_customer_landing_to_rawdb_csv : cdc_main.py.cdc_customer_landing_to_rawdb_csv: line(34) : Fetched dst delta table raw.cdc_customer from file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/raw/cdc_customer
INFO : 2022-08-07 20:13:43,578 : cdc_customer_landing_to_rawdb_csv : cdc_main.py.cdc_customer_landing_to_rawdb_csv: line(41) : Fetched dst delta table raw.cdc_customer_history from file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/raw/cdc_customer_history
INFO : 2022-08-07 20:13:43,733 : cdc_customer_landing_to_rawdb_csv : cdc_main.py.cdc_customer_landing_to_rawdb_csv: line(92) : Change set
+---+-------------------+---------+----------+---------+--------------------+-------+----------------+------+----------+----------+-------+------+--------------------+--------------------+--------------------+
| id|       extract_date|load_flag|first_name|last_name|               email| gender|       job_title|amount| from_date|   to_date|version|active|     _correlation_id|     _load_timestamp|           _filename|
+---+-------------------+---------+----------+---------+--------------------+-------+----------------+------+----------+----------+-------+------+--------------------+--------------------+--------------------+
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  1|2008-01-01 00:00:00|        I|   Davidde|   Legier|    dlegier0@mail.ru|Agender|          Editor|  86.5|2008-01-01|9999-12-31|      2| false|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
|  2|2008-01-01 00:00:00|        I|  Panchito|  Scirman|pscirman1@kicksta...|   Male|Junior Executive| 36.18|2008-01-01|2007-12-31|      1|  true|86b02a72-2e35-413...|2022-08-07 20:13:...|file:///Users/sha...|
+---+-------------------+---------+----------+---------+--------------------+-------+----------------+------+----------+----------+-------+------+--------------------+--------------------+--------------------+
only showing top 20 rows

ERROR : 2022-08-07 20:13:46,706 : cdc_customer_landing_to_rawdb_csv : _framework.py.wrap_function: line(56) : Dataflow application cdc_customer_landing_to_rawdb_csv failed due to An error occurred while calling o415.execute.
: org.apache.spark.sql.delta.DeltaUnsupportedOperationException: Cannot perform Merge as multiple source rows matched and attempted to modify the same
target row in the Delta table in possibly conflicting ways. By SQL semantics of Merge,
when multiple source rows match on the same target row, the result may be ambiguous
as it is unclear which source row should be used to update or delete the matching
target row. You can preprocess the source table to eliminate the possibility of
multiple matches. Please refer to
https://docs.delta.io/latest/delta-update.html#upsert-into-a-table-using-merge
	at org.apache.spark.sql.delta.DeltaErrorsBase.multipleSourceRowMatchingTargetRowInMergeException(DeltaErrors.scala:1028)
	at org.apache.spark.sql.delta.DeltaErrorsBase.multipleSourceRowMatchingTargetRowInMergeException$(DeltaErrors.scala:1025)
	at org.apache.spark.sql.delta.DeltaErrors$.multipleSourceRowMatchingTargetRowInMergeException(DeltaErrors.scala:2264)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.$anonfun$findTouchedFiles$1(MergeIntoCommand.scala:434)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.recordMergeOperation(MergeIntoCommand.scala:855)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.findTouchedFiles(MergeIntoCommand.scala:370)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.$anonfun$run$2(MergeIntoCommand.scala:317)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.$anonfun$run$2$adapted(MergeIntoCommand.scala:300)
	at org.apache.spark.sql.delta.DeltaLog.withNewTransaction(DeltaLog.scala:224)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.$anonfun$run$1(MergeIntoCommand.scala:300)
	at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.java:23)
	at org.apache.spark.sql.delta.metering.DeltaLogging.recordFrameProfile(DeltaLogging.scala:141)
	at org.apache.spark.sql.delta.metering.DeltaLogging.recordFrameProfile$(DeltaLogging.scala:139)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.recordFrameProfile(MergeIntoCommand.scala:206)
	at org.apache.spark.sql.delta.metering.DeltaLogging.$anonfun$recordDeltaOperationInternal$1(DeltaLogging.scala:134)
	at com.databricks.spark.util.DatabricksLogging.recordOperation(DatabricksLogging.scala:77)
	at com.databricks.spark.util.DatabricksLogging.recordOperation$(DatabricksLogging.scala:67)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.recordOperation(MergeIntoCommand.scala:206)
	at org.apache.spark.sql.delta.metering.DeltaLogging.recordDeltaOperationInternal(DeltaLogging.scala:133)
	at org.apache.spark.sql.delta.metering.DeltaLogging.recordDeltaOperation(DeltaLogging.scala:123)
	at org.apache.spark.sql.delta.metering.DeltaLogging.recordDeltaOperation$(DeltaLogging.scala:111)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.recordDeltaOperation(MergeIntoCommand.scala:206)
	at org.apache.spark.sql.delta.commands.MergeIntoCommand.run(MergeIntoCommand.scala:298)
	at io.delta.tables.DeltaMergeBuilder.$anonfun$execute$1(DeltaMergeBuilder.scala:231)
	at org.apache.spark.sql.delta.util.AnalysisHelper.improveUnsupportedOpError(AnalysisHelper.scala:105)
	at org.apache.spark.sql.delta.util.AnalysisHelper.improveUnsupportedOpError$(AnalysisHelper.scala:91)
	at io.delta.tables.DeltaMergeBuilder.improveUnsupportedOpError(DeltaMergeBuilder.scala:123)
	at io.delta.tables.DeltaMergeBuilder.execute(DeltaMergeBuilder.scala:207)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)
	at py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)
	at py4j.Gateway.invoke(Gateway.java:282)
	at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)
	at py4j.commands.CallCommand.execute(CallCommand.java:79)
	at py4j.ClientServerConnection.waitForCommands(ClientServerConnection.java:182)
	at py4j.ClientServerConnection.run(ClientServerConnection.java:106)
	at java.base/java.lang.Thread.run(Thread.java:834)
.
