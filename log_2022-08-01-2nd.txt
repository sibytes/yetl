INFO : 2022-08-07 21:31:00,727 : cdc_customer_landing_to_rawdb_csv : _config_provider.py.load_config: line(41) : Loading Dataflow configuration from file /Users/shaunryan/AzureDevOps/yetl/config/pipeline/local/config.yaml
INFO : 2022-08-07 21:31:00,729 : cdc_customer_landing_to_rawdb_csv : _context.py._get_spark_context: line(85) : Setting spark context
:: loading settings :: url = jar:file:/Users/shaunryan/opt/spark-3.2.1-bin-hadoop3.2/jars/ivy-2.5.0.jar!/org/apache/ivy/core/settings/ivysettings.xml
INFO : 2022-08-07 21:31:05,640 : cdc_customer_landing_to_rawdb_csv : _context.py.__init__: line(50) : Setting application context spark logger at level ERROR
INFO : 2022-08-07 21:31:05,644 : cdc_customer_landing_to_rawdb_csv : _factory.py.get_file_system_type: line(50) : Setting filestystem using protocol file:
INFO : 2022-08-07 21:31:05,644 : cdc_customer_landing_to_rawdb_csv : _context.py.__init__: line(66) : Setting application context dataflow cdc_customer_landing_to_rawdb_csv
INFO : 2022-08-07 21:31:05,644 : cdc_customer_landing_to_rawdb_csv : _config_provider.py.load_pipeline_config: line(29) : Loading Dataflow configuration from file /Users/shaunryan/AzureDevOps/yetl/config/pipeline/local/cdc_customer_landing_to_rawdb_csv.yaml
INFO : 2022-08-07 21:31:05,657 : cdc_customer_landing_to_rawdb_csv : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on spark_schema_file 
INFO : 2022-08-07 21:31:05,657 : cdc_customer_landing_to_rawdb_csv : _spark_file_schema_repo.py.load_schema: line(50) : Loading schema for dataset landing.cdc_customer from /Users/shaunryan/AzureDevOps/yetl/config/schema/spark/landing/cdc_customer.yaml using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-07 21:31:05,662 : cdc_customer_landing_to_rawdb_csv : _reader.py.__init__: line(49) : auto_io = True automatically creating or altering exception delta table landing.cdc_customer _correlation_id=cb7e0803-b82d-4d99-ad11-8f58161735ba
INFO : 2022-08-07 21:31:05,662 : cdc_customer_landing_to_rawdb_csv : _delta_lake.py.create_database: line(27) : Creating database if not exists `landing`
INFO : 2022-08-07 21:31:13,764 : cdc_customer_landing_to_rawdb_csv : _reader.py.create_or_alter_table: line(61) : Exception table already exists landing.exceptions at file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/exceptions/landing/exceptions _correlation_id=cb7e0803-b82d-4d99-ad11-8f58161735ba
INFO : 2022-08-07 21:31:13,764 : cdc_customer_landing_to_rawdb_csv : _reader.py.read: line(195) : Reading data for landing.cdc_customer from file:/Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv with options {'mode': 'PERMISSIVE', 'inferSchema': False, 'header': True, 'timestampFormat': 'yyyy-MM-dd HH:mm:ss'} _correlation_id=cb7e0803-b82d-4d99-ad11-8f58161735ba
INFO : 2022-08-07 21:31:14,163 : cdc_customer_landing_to_rawdb_csv : _reader.py.validate: line(181) : Validating dataframe read using PERMISSIVE corrupt column at _corrupt_record _correlation_id=cb7e0803-b82d-4d99-ad11-8f58161735ba
INFO : 2022-08-07 21:31:15,523 : cdc_customer_landing_to_rawdb_csv : _reader.py.validate: line(192) : {
    "validation": {
        "schema_on_read": {
            "landing.cdc_customer": {
                "total_count": 10,
                "valid_count": 10,
                "exception_count": 0
            }
        }
    }
}
INFO : 2022-08-07 21:31:15,523 : cdc_customer_landing_to_rawdb_csv : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on deltalake_sql_file 
INFO : 2022-08-07 21:31:15,523 : cdc_customer_landing_to_rawdb_csv : _deltalake_sql_file.py.load_schema: line(43) : Loading schema for dataset raw.cdc_customer from ./config/schema/deltalake/raw/cdc_customer.sql using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-07 21:31:15,523 : cdc_customer_landing_to_rawdb_csv : _writer.py.__init__: line(40) : auto_io = True automatically creating or altering delta table raw.cdc_customer
INFO : 2022-08-07 21:31:15,524 : cdc_customer_landing_to_rawdb_csv : _delta_lake.py.create_database: line(27) : Creating database if not exists `raw`
INFO : 2022-08-07 21:31:15,648 : cdc_customer_landing_to_rawdb_csv : _writer.py.create_or_alter_table: line(88) : Table already exists raw.cdc_customer at file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/raw/cdc_customer
INFO : 2022-08-07 21:31:15,648 : cdc_customer_landing_to_rawdb_csv : _delta_lake.py.get_table_properties: line(69) : getting existing table properties for table raw.cdc_customer
INFO : 2022-08-07 21:31:22,844 : cdc_customer_landing_to_rawdb_csv : _delta_lake.py.get_table_properties: line(91) : {
    "raw.cdc_customer": {
        "constraints": {
            "amount_lower_bound": "amount > - 1000",
            "amount_upper_bound": "amount < 1000000"
        },
        "properties": {
            "Type": "EXTERNAL",
            "delta.appendOnly": "False",
            "delta.checkpoint.writeStatsAsJson": "True",
            "delta.compatibility.symlinkFormatManifest.enabled": "False",
            "delta.dataSkippingNumIndexedCols": "-1",
            "delta.deletedFileRetentionDuration": "interval 1 week",
            "delta.enableChangeDataFeed": "True",
            "delta.logRetentionDuration": "interval 30 days",
            "delta.minReaderVersion": "1",
            "delta.minWriterVersion": "4",
            "delta.randomPrefixLength": "2",
            "delta.randomizeFilePrefixes": "False",
            "external": "true"
        }
    }
}
INFO : 2022-08-07 21:31:32,405 : cdc_customer_landing_to_rawdb_csv : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on deltalake_sql_file 
INFO : 2022-08-07 21:31:32,405 : cdc_customer_landing_to_rawdb_csv : _deltalake_sql_file.py.load_schema: line(43) : Loading schema for dataset raw.cdc_customer_history from ./config/schema/deltalake/raw/cdc_customer_history.sql using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-07 21:31:32,405 : cdc_customer_landing_to_rawdb_csv : _writer.py.__init__: line(40) : auto_io = True automatically creating or altering delta table raw.cdc_customer_history
INFO : 2022-08-07 21:31:32,405 : cdc_customer_landing_to_rawdb_csv : _delta_lake.py.create_database: line(27) : Creating database if not exists `raw`
INFO : 2022-08-07 21:31:32,466 : cdc_customer_landing_to_rawdb_csv : _writer.py.create_or_alter_table: line(88) : Table already exists raw.cdc_customer_history at file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/raw/cdc_customer_history
INFO : 2022-08-07 21:31:32,466 : cdc_customer_landing_to_rawdb_csv : _delta_lake.py.get_table_properties: line(69) : getting existing table properties for table raw.cdc_customer_history
INFO : 2022-08-07 21:31:34,627 : cdc_customer_landing_to_rawdb_csv : _delta_lake.py.get_table_properties: line(91) : {
    "raw.cdc_customer_history": {
        "constraints": {
            "amount_lower_bound": "amount > - 1000",
            "amount_upper_bound": "amount < 1000000"
        },
        "properties": {
            "Type": "EXTERNAL",
            "delta.appendOnly": "False",
            "delta.checkpoint.writeStatsAsJson": "True",
            "delta.compatibility.symlinkFormatManifest.enabled": "False",
            "delta.dataSkippingNumIndexedCols": "-1",
            "delta.deletedFileRetentionDuration": "interval 1 week",
            "delta.enableChangeDataFeed": "True",
            "delta.logRetentionDuration": "interval 30 days",
            "delta.minReaderVersion": "1",
            "delta.minWriterVersion": "4",
            "delta.randomPrefixLength": "2",
            "delta.randomizeFilePrefixes": "False",
            "external": "true"
        }
    }
}
INFO : 2022-08-07 21:31:41,355 : cdc_customer_landing_to_rawdb_csv : _framework.py.wrap_function: line(36) : Executing Dataflow cdc_customer_landing_to_rawdb_csv with:
                timeslice=2022-08-01 00:00:00.000000 
                retries=1 
                save_type=DefaultSave
INFO : 2022-08-07 21:31:41,440 : cdc_customer_landing_to_rawdb_csv : cdc_main.py.cdc_customer_landing_to_rawdb_csv: line(34) : Fetched dst delta table raw.cdc_customer from file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/raw/cdc_customer
INFO : 2022-08-07 21:31:41,449 : cdc_customer_landing_to_rawdb_csv : cdc_main.py.cdc_customer_landing_to_rawdb_csv: line(41) : Fetched dst delta table raw.cdc_customer_history from file:/Users/shaunryan/AzureDevOps/yetl/data/delta_lake/raw/cdc_customer_history
INFO : 2022-08-07 21:31:41,906 : cdc_customer_landing_to_rawdb_csv : cdc_main.py.cdc_customer_landing_to_rawdb_csv: line(96) : Change set
+---+-------------------+---------+----------+---------------+-----------------------------+----------+-----------------------+------+----------+----------+-------+------+------------------------------------+--------------------------+--------------------------------------------------------------------------------------+
|id |extract_date       |load_flag|first_name|last_name      |email                        |gender    |job_title              |amount|from_date |to_date   |version|active|_correlation_id                     |_load_timestamp           |_filename                                                                             |
+---+-------------------+---------+----------+---------------+-----------------------------+----------+-----------------------+------+----------+----------+-------+------+------------------------------------+--------------------------+--------------------------------------------------------------------------------------+
|1  |2008-01-01 00:00:00|I        |Davidde   |Legier         |dlegier0@mail.ru             |Agender   |Editor                 |86.5  |2008-01-01|9999-12-31|1      |true  |cb7e0803-b82d-4d99-ad11-8f58161735ba|2022-08-07 21:31:14.629665|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|2  |2008-01-01 00:00:00|I        |Panchito  |Scirman        |pscirman1@kickstarter.com    |Male      |Junior Executive       |36.18 |2008-01-01|9999-12-31|1      |true  |cb7e0803-b82d-4d99-ad11-8f58161735ba|2022-08-07 21:31:14.629665|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|3  |2008-01-01 00:00:00|I        |Chic      |Ickowics       |cickowics2@booking.com       |Male      |Research Associate     |35.54 |2008-01-01|9999-12-31|1      |true  |cb7e0803-b82d-4d99-ad11-8f58161735ba|2022-08-07 21:31:14.629665|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|4  |2008-01-01 00:00:00|I        |Pascale   |Jedrzaszkiewicz|pjedrzaszkiewicz3@auda.org.au|Male      |Safety Technician IV   |73.21 |2008-01-01|9999-12-31|1      |true  |cb7e0803-b82d-4d99-ad11-8f58161735ba|2022-08-07 21:31:14.629665|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|5  |2008-01-01 00:00:00|I        |Sara      |Whiterod       |swhiterod4@hhs.gov           |Female    |Assistant Manager      |47.85 |2008-01-01|9999-12-31|1      |true  |cb7e0803-b82d-4d99-ad11-8f58161735ba|2022-08-07 21:31:14.629665|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|6  |2008-01-01 00:00:00|I        |Mariska   |Antrum         |mantrum5@nytimes.com         |Female    |Tax Accountant         |16.37 |2008-01-01|9999-12-31|1      |true  |cb7e0803-b82d-4d99-ad11-8f58161735ba|2022-08-07 21:31:14.629665|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|7  |2008-01-01 00:00:00|I        |Ingemar   |Petrus         |ipetrus6@blogspot.com        |Male      |Chief Design Engineer  |49.02 |2008-01-01|9999-12-31|1      |true  |cb7e0803-b82d-4d99-ad11-8f58161735ba|2022-08-07 21:31:14.629665|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|8  |2008-01-01 00:00:00|I        |Anstice   |Hollingdale    |ahollingdale7@yahoo.co.jp    |Female    |Cost Accountant        |21.94 |2008-01-01|9999-12-31|1      |true  |cb7e0803-b82d-4d99-ad11-8f58161735ba|2022-08-07 21:31:14.629665|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|9  |2008-01-01 00:00:00|I        |Chaunce   |Holdforth      |choldforth8@ca.gov           |Non-binary|Chief Design Engineer  |72.0  |2008-01-01|9999-12-31|1      |true  |cb7e0803-b82d-4d99-ad11-8f58161735ba|2022-08-07 21:31:14.629665|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|10 |2008-01-01 00:00:00|I        |Blinni    |Fenty          |bfenty9@paginegialle.it      |Female    |Assistant Media Planner|38.98 |2008-01-01|9999-12-31|1      |true  |cb7e0803-b82d-4d99-ad11-8f58161735ba|2022-08-07 21:31:14.629665|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
+---+-------------------+---------+----------+---------------+-----------------------------+----------+-----------------------+------+----------+----------+-------+------+------------------------------------+--------------------------+--------------------------------------------------------------------------------------+

INFO : 2022-08-07 21:32:09,983 : cdc_customer_landing_to_rawdb_csv : cdc_main.py.cdc_customer_landing_to_rawdb_csv: line(116) : Current
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+----------+----------+-------+------+------------------------------------+--------------------------+--------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name      |email                        |gender    |job_title              |amount|from_date |to_date   |version|active|_correlation_id                     |_load_timestamp           |_filename                                                                             |
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+----------+----------+-------+------+------------------------------------+--------------------------+--------------------------------------------------------------------------------------+
|2008-01-01 00:00:00|I        |4  |Pascale   |Jedrzaszkiewicz|pjedrzaszkiewicz3@auda.org.au|Male      |Safety Technician IV   |73.21 |2008-01-01|9999-12-31|1      |true  |74263e3d-7eb0-40f3-baa3-a9af59c572d4|2022-08-07 21:29:50.668816|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |9  |Chaunce   |Holdforth      |choldforth8@ca.gov           |Non-binary|Chief Design Engineer  |72.0  |2008-01-01|9999-12-31|1      |true  |74263e3d-7eb0-40f3-baa3-a9af59c572d4|2022-08-07 21:29:50.668816|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |8  |Anstice   |Hollingdale    |ahollingdale7@yahoo.co.jp    |Female    |Cost Accountant        |21.94 |2008-01-01|9999-12-31|1      |true  |74263e3d-7eb0-40f3-baa3-a9af59c572d4|2022-08-07 21:29:50.668816|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |10 |Blinni    |Fenty          |bfenty9@paginegialle.it      |Female    |Assistant Media Planner|38.98 |2008-01-01|9999-12-31|1      |true  |74263e3d-7eb0-40f3-baa3-a9af59c572d4|2022-08-07 21:29:50.668816|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |2  |Panchito  |Scirman        |pscirman1@kickstarter.com    |Male      |Junior Executive       |36.18 |2008-01-01|9999-12-31|1      |true  |74263e3d-7eb0-40f3-baa3-a9af59c572d4|2022-08-07 21:29:50.668816|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |7  |Ingemar   |Petrus         |ipetrus6@blogspot.com        |Male      |Chief Design Engineer  |49.02 |2008-01-01|9999-12-31|1      |true  |74263e3d-7eb0-40f3-baa3-a9af59c572d4|2022-08-07 21:29:50.668816|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |3  |Chic      |Ickowics       |cickowics2@booking.com       |Male      |Research Associate     |35.54 |2008-01-01|9999-12-31|1      |true  |74263e3d-7eb0-40f3-baa3-a9af59c572d4|2022-08-07 21:29:50.668816|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |5  |Sara      |Whiterod       |swhiterod4@hhs.gov           |Female    |Assistant Manager      |47.85 |2008-01-01|9999-12-31|1      |true  |74263e3d-7eb0-40f3-baa3-a9af59c572d4|2022-08-07 21:29:50.668816|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |6  |Mariska   |Antrum         |mantrum5@nytimes.com         |Female    |Tax Accountant         |16.37 |2008-01-01|9999-12-31|1      |true  |74263e3d-7eb0-40f3-baa3-a9af59c572d4|2022-08-07 21:29:50.668816|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |1  |Davidde   |Legier         |dlegier0@mail.ru             |Agender   |Editor                 |86.5  |2008-01-01|9999-12-31|1      |true  |74263e3d-7eb0-40f3-baa3-a9af59c572d4|2022-08-07 21:29:50.668816|file:///Users/shaunryan/AzureDevOps/yetl/data/landing/202208/cdc_customer_20220801.csv|
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+----------+----------+-------+------+------------------------------------+--------------------------+--------------------------------------------------------------------------------------+

INFO : 2022-08-07 21:32:18,762 : cdc_customer_landing_to_rawdb_csv : cdc_main.py.cdc_customer_landing_to_rawdb_csv: line(146) : History
+------------+---------+---+----------+---------+-----+------+---------+------+---------+-------+-------+------+---------------+---------------+---------+
|extract_date|load_flag|id |first_name|last_name|email|gender|job_title|amount|from_date|to_date|version|active|_correlation_id|_load_timestamp|_filename|
+------------+---------+---+----------+---------+-----+------+---------+------+---------+-------+-------+------+---------------+---------------+---------+
+------------+---------+---+----------+---------+-----+------+---------+------+---------+-------+-------+------+---------------+---------------+---------+

INFO : 2022-08-07 21:32:19,067 : cdc_customer_landing_to_rawdb_csv : _delta_lake.py.get_audit: line(34) : Auditing database table raw.cdc_customer
INFO : 2022-08-07 21:32:19,592 : cdc_customer_landing_to_rawdb_csv : _delta_lake.py.get_audit: line(34) : Auditing database table raw.cdc_customer_history
INFO : 2022-08-07 21:32:19,922 : cdc_customer_landing_to_rawdb_csv : _delta_lake.py.get_audits: line(48) : {
    "raw.cdc_customer": {
        "clusterId": null,
        "engineInfo": "Apache-Spark/3.2.1 Delta-Lake/2.0.0",
        "isBlindAppend": false,
        "isolationLevel": "Serializable",
        "job": null,
        "notebook": null,
        "operation": "MERGE",
        "operationMetrics": {
            "executionTimeMs": "20189",
            "numOutputRows": "10",
            "numSourceRows": "10",
            "numTargetChangeFilesAdded": "0",
            "numTargetFilesAdded": "10",
            "numTargetFilesRemoved": "10",
            "numTargetRowsCopied": "10",
            "numTargetRowsDeleted": "0",
            "numTargetRowsInserted": "0",
            "numTargetRowsUpdated": "0",
            "rewriteTimeMs": "15298",
            "scanTimeMs": "4887"
        },
        "operationParameters": {
            "matchedPredicates": "[{\"predicate\":\"((src.load_flag IN ('I', 'U')) AND (NOT (src.extract_date = dst.extract_date)))\",\"actionType\":\"update\"},{\"predicate\":\"(src.load_flag = 'D')\",\"actionType\":\"delete\"}]",
            "notMatchedPredicates": "[{\"predicate\":\"(src.load_flag IN ('I', 'U'))\",\"actionType\":\"insert\"}]",
            "predicate": "(dst.id = src.id)"
        },
        "readVersion": 7,
        "timestamp": "2022-08-07 21:32:06.083000",
        "userId": null,
        "userMetadata": null,
        "userName": null,
        "version": 8
    },
    "raw.cdc_customer_history": {
        "clusterId": null,
        "engineInfo": "Apache-Spark/3.2.1 Delta-Lake/2.0.0",
        "isBlindAppend": false,
        "isolationLevel": "SnapshotIsolation",
        "job": null,
        "notebook": null,
        "operation": "MERGE",
        "operationMetrics": {
            "executionTimeMs": "5443",
            "numOutputRows": "0",
            "numSourceRows": "0",
            "numTargetChangeFilesAdded": "0",
            "numTargetFilesAdded": "0",
            "numTargetFilesRemoved": "0",
            "numTargetRowsCopied": "0",
            "numTargetRowsDeleted": "0",
            "numTargetRowsInserted": "0",
            "numTargetRowsUpdated": "0",
            "rewriteTimeMs": "1408",
            "scanTimeMs": "4032"
        },
        "operationParameters": {
            "matchedPredicates": "[{\"predicate\":\"(((NOT (dst.from_date = src.from_date)) OR (NOT (dst.to_date = src.to_date))) OR ((NOT (dst.version = src.version)) OR (NOT (dst.active = src.active))))\",\"actionType\":\"update\"}]",
            "notMatchedPredicates": "[{\"actionType\":\"insert\"}]",
            "predicate": "((dst.id = src.id) AND (dst.extract_date = src.extract_date))"
        },
        "readVersion": 7,
        "timestamp": "2022-08-07 21:32:15.936000",
        "userId": null,
        "userMetadata": null,
        "userName": null,
        "version": 8
    }
}
